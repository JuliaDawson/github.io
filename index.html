<!DOCTYPE html>
<html>
  <head>    
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>Shared Prosperity Bargraphs Income Distribution</title>
   <!--<script type="text/javascript" src="d3/d3.v2.js"></script>-->
    <script src='https://d3js.org/d3.v5.min.js'></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src='https://d3js.org/topojson.v1.min.js'></script>
    <script src="https://d3js.org/d3-queue.v3.min.js"></script>

    <style type="text/css">
    .hideme {
        hidden:true
    }    
`
#mapChart {    
	position:absolute;
	top:10px;
	left:10px;
	height: 400px;
	width: 500px;
}
	    
#lineChart {    
	position:absolute;
	top:10px;
	left:510px;
	height: 150px;
}

#barChart {
	position:absolute;
	top:10px;
	left:510px;
	width: 250px;
	height: 250px;
}

.slice {
   font-size: 12pt;
   font-family: Verdana;
   fill: white; //svg specific - instead of color
   font-weight: bold;	
  		} 

div.tooltip {	
      color: black; 
      font: normal 70%/1.4 Roboto;	
      background: yellow; 
      border-radius: 3px; 
      box-shadow: 0px 0px 2px 0px #a6a6a6; 
      padding: .2em; 
      text-shadow: #f5f5f5 0 1px 0;
      opacity: 0.9; 
      position: absolute;
      text-align: center;			
      width: auto;					
      height: auto; 					
      padding: 2px;				
}	    
  <title>Map Data Across the Globe</title>
	    

/*for line chart*/
.axis path, .axis line {
    fill: none;
    stroke: black;
    shape-rendering: crispEdges; //The shape-rendering property is an SVG attribute, used here to make sure our axis and its tick mark lines are pixel-perfect. 
}

.line {
  fill: none;
  /*stroke: steelblue;*/
  stroke-width: 3px;
}

.dot {
  /*fill: white;*/
  /*stroke: steelblue;*/
  stroke-width: 1.5px;
  }
				

.axis text {
    font-family: Roboto;
    font-size: 11px;
}

.title {
	 font-family: Roboto;
    font-size: 15px;	
		
}

.xAxis {
    font-family: Roboto;
    font-size: 10px;
    fill: black;
}  

.yOnBar {
    font-family: Roboto;
    font-size: 9px;
    fill: white;
}

  
table {
	border-collapse:collapse;
	border: 0px;	
	font-family: Roboto;	
	color: #5C5558;
	font-size: 12px;
	text-align: right;			
}

td {
	padding-left: 10px;		
}

#lineChartTitle1 {
	font-family: Roboto;
	font-size  : 14px;
	fill       : lightgrey;
	font-weight: bold;
	text-anchor: middle;
}

#lineChartTitle2 {
	font-family: Roboto;
	font-size  : 72px;
	fill       : grey;
	text-anchor: middle;
	font-weight: bold;
	/*font-style: italic;*/
}
				 
    </style>
  </head>
  <div class="tooltip"></div>  	
  <body>
 	  
    <div id="mapChart" class=".hideme"></div>  
    <div id="barChart" class=".hideme"></div>  
    <div id="lineChart" class=".hideme"></div>  
 
 
    <script type="text/javascript">
	    
 //console.log("Before read csv in beginning"); 	  
 //const dataBarNew = d3.csv("MatchTopo_Distribution_of_Income.csv", function(data) {
//	  console.log(data);
//		for (var i = 0; i < data.length; i++) {
//		    console.log(data[i].DISPCountry);
//		    console.log(data[i].DISPRegion);
//		    console.log(data[i].DIGiniIndex);
//		    console.log(data[i].DIPctIncShareHighest10);
//		    console.log(data[i].DIPctIncShareLowest10);
//		}
//	    return {	
//		    countryName: data.DISPCountry,
//		    region:     data.DISPRegion,
//		    giniIndex: +data.DIGiniIndex,
//		    incPctHi10: +data.DIPctIncShareHighest10,
//		    incPctLo10: +data.DIPctIncShareLowest10
//	    }	    
//
//   });	  
//   console.log("After read csv in beginning" + dataBarNew); 
						
    
/*
################ FORMATS ##################
-------------------------------------------
*/
d3.selectAll(".tick")
     .on("click",clickme)	    
function clickme(d){
    console.log("clickme " + d + d.id);	
    // Select element that should be shown
    const element = d3.select("#"+d.id); // Or however you're deriving id

    // Determine whether the element needs to be shown or hidden
    const show = element.style('display') === 'none';

    // Hide any tooltip that may be shown
    d3.selectAll('.tooltip').style('display', 'show'); //was none

    // Show element, if appropriate
    if (show) element.style('display', 'block');
}
/*============================================================================================================*/
/* start of New for Map Chart                                                                                          */
/*------------------------------------------------------------------------------------------------------------*/
function dsMapChart(){
var height = 400;
var width = 500;
var margin = 10;	

//d3.selectAll('svg > g > *').remove(); 

var projection = d3.geoMercator().translate([width/2,height/2]).scale(70);
var path = d3.geoPath().projection(projection);

//Read Topo file and CSV containing economic information
//var worldmap = d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json");
var worldmap = d3.json("countries-110m-edited_wout_Antarctica.json");

Promise.all([worldmap]).then(values => {
	
var plot = d3.select("#mapChart")
	.append("svg:svg")
	.attr("width", width)           //set the width and height of our visualization (these will be attributes of the <svg> tag
	.attr("height", height)
	.append("svg:g")                //make a group to hold our map chart
	.attr("transform", "translate(10,100)");

 var tooltip = d3.select("div.tooltip");
		
 var countries = topojson.feature(values[0], values[0].objects.countries).features; 
   
   plot.selectAll('path')
	.data(countries)
	.enter().append('path')
	.attr('class','country')
	 //.attr('fill', 'lightgrey')
	.attr("fill", function(d) { 
             //console.log("d", d)
             //console.log("giniIndex", d.properties.giniindex)
             var col =  d3.interpolateBlues((d.properties.giniindex - 20) / 44); 
             //console.log("col", col)
             if (col) {
               //console.log("found col", col, "for d", d)
               return col
             } else {
               return 'white'
             }
           })
	   .attr('stroke', 'black') 
	   .attr('stroke-width', '1')
	   .attr('d', path)
	   //.attr('fake', d=> console.log(d.properties.name))
    .on("mouseover", function(d,i) {
      //console.log("mouseover  ",d.properties.name);	   
      //console.log("mouseover  ",d.properties.region);	   
      //console.log("mouseover  ",d.properties.giniindex);	   
      d3.select(this)
	      .attr("stroke","black").attr("stroke-width",4);
      //      .attr("fill","orange").attr("stroke-width",2);
      //return tooltip.style("hidden", false).html("Country: " + d.properties.name + d.properties.region  + d.properties.giniindex)
      return tooltip.style("hidden", false)
	.html( "<b>" + d.properties.name + "</b>"  
	      + "<br>"  + d.properties.region  
	      + "<br>" +  "GiniIndex: "  + "<b>" + d.properties.giniindex  + "</b>" );
      })
    .on("mousemove",function(d){
       tooltip.classed("hidden", false)
               .style("top", (d3.event.pageY) + "px")
               .style("left", (d3.event.pageX + 10) + "px")
               //.html("Country: " + d.properties.name + d.properties.region + d.properties.giniindex)
	.html( "<b>" + d.properties.name + "</b>"  
	      + "<br>"  + d.properties.region  
	      + "<br>" +  "GiniIndex: "  + "<b>" + d.properties.giniindex  + "</b>" );
     })	
     .on("mouseout",function(d,i){
         d3.select(this)
	 .attr("stroke","black")
	 .attr("stroke-width",1);
         tooltip.classed("hidden", true);
	 console.log("Mouseout: " + this);  
      })

})
}


/*------------------------------------------------------------------------------------------------------------*/	    
/* End of New for Map Chart                                                                                          */
/*============================================================================================================*/

	    
/*============================================================================================================*/
/* Start of Bar Chart  Gini Index                                                                                          */
/*------------------------------------------------------------------------------------------------------------*/	    
 var dataBarChart = [
{ countryName: "South Africa", region: "Africa",  giniIndex: 63, incPctLo10: 50.5, incPctHi10: 0.9 },
{ countryName: "Namibia", region: "Africa",  giniIndex: 59.1, incPctLo10: 47.3, incPctHi10: 1 },
{ countryName: "Zambia", region: "Africa",  giniIndex: 57.1, incPctLo10: 44.4, incPctHi10: 1 },
{ countryName: "Sao Tome and Principe", region: "Africa",  giniIndex: 56.3, incPctLo10: 49.1, incPctHi10: 1.3 },
{ countryName: "Central African Rep.", region: "Africa",  giniIndex: 56.2, incPctLo10: 46.2, incPctHi10: 1.2 },
{ countryName: "eSwatini", region: "Africa",  giniIndex: 54.6, incPctLo10: 42.7, incPctHi10: 1.4 },
{ countryName: "Mozambique", region: "Africa",  giniIndex: 54, incPctLo10: 45.5, incPctHi10: 1.6 },
{ countryName: "Botswana", region: "Africa",  giniIndex: 53.3, incPctLo10: 41.5, incPctHi10: 1.5 },
{ countryName: "Angola", region: "Africa",  giniIndex: 51.3, incPctLo10: 39.6, incPctHi10: 1.3 },
{ countryName: "Guinea-Bissau", region: "Africa",  giniIndex: 50.7, incPctLo10: 42, incPctHi10: 1.6 },
{ countryName: "Congo", region: "Africa",  giniIndex: 48.9, incPctLo10: 37.9, incPctHi10: 1.6 },
{ countryName: "Benin", region: "Africa",  giniIndex: 47.8, incPctLo10: 37.6, incPctHi10: 1 },
{ countryName: "Seychelles", region: "Africa",  giniIndex: 46.8, incPctLo10: 39.9, incPctHi10: 1.9 },
{ countryName: "Cameroon", region: "Africa",  giniIndex: 46.6, incPctLo10: 35, incPctHi10: 1.7 },
{ countryName: "S. Sudan", region: "Africa",  giniIndex: 46.3, incPctLo10: 33.2, incPctHi10: 1.3 },
{ countryName: "Lesotho", region: "Africa",  giniIndex: 44.9, incPctLo10: 32.9, incPctHi10: 1.7 },
{ countryName: "Malawi", region: "Africa",  giniIndex: 44.7, incPctLo10: 38.1, incPctHi10: 2.6 },
{ countryName: "Zimbabwe", region: "Africa",  giniIndex: 44.3, incPctLo10: 34.8, incPctHi10: 2.5 },
{ countryName: "Rwanda", region: "Africa",  giniIndex: 43.7, incPctLo10: 35.6, incPctHi10: 2.4 },
{ countryName: "Ghana", region: "Africa",  giniIndex: 43.5, incPctLo10: 32.2, incPctHi10: 1.6 },
{ countryName: "Chad", region: "Africa",  giniIndex: 43.3, incPctLo10: 32.4, incPctHi10: 1.8 },
{ countryName: "Togo", region: "Africa",  giniIndex: 43.1, incPctLo10: 31.6, incPctHi10: 1.9 },
{ countryName: "Uganda", region: "Africa",  giniIndex: 42.8, incPctLo10: 34.2, incPctHi10: 2.5 },
{ countryName: "Madagascar", region: "Africa",  giniIndex: 42.6, incPctLo10: 33.5, incPctHi10: 2.2 },
{ countryName: "Cabo Verde", region: "Africa",  giniIndex: 42.4, incPctLo10: 32.3, incPctHi10: 2.2 },
{ countryName: "Dem. Rep. Congo", region: "Africa",  giniIndex: 42.1, incPctLo10: 32, incPctHi10: 2.1 },
{ countryName: "CÃ´te d'Ivoire", region: "Africa",  giniIndex: 41.5, incPctLo10: 31.9, incPctHi10: 2.1 },
{ countryName: "Kenya", region: "Africa",  giniIndex: 40.8, incPctLo10: 31.6, incPctHi10: 2.4 },
{ countryName: "Tanzania", region: "Africa",  giniIndex: 40.5, incPctLo10: 33.1, incPctHi10: 2.9 },
{ countryName: "Senegal", region: "Africa",  giniIndex: 40.3, incPctLo10: 31, incPctHi10: 2.3 },
{ countryName: "Burundi", region: "Africa",  giniIndex: 38.6, incPctLo10: 31, incPctHi10: 2.8 },
{ countryName: "Gabon", region: "Africa",  giniIndex: 38, incPctLo10: 27.7, incPctHi10: 2.2 },
{ countryName: "Mauritius", region: "Africa",  giniIndex: 36.8, incPctLo10: 29.9, incPctHi10: 2.9 },
{ countryName: "Gambia", region: "Africa",  giniIndex: 35.9, incPctLo10: 28.7, incPctHi10: 3 },
{ countryName: "Sierra Leone", region: "Africa",  giniIndex: 35.7, incPctLo10: 29.4, incPctHi10: 3.4 },
{ countryName: "Burkina Faso", region: "Africa",  giniIndex: 35.3, incPctLo10: 29.6, incPctHi10: 3.6 },
{ countryName: "Liberia", region: "Africa",  giniIndex: 35.3, incPctLo10: 27.1, incPctHi10: 2.9 },
{ countryName: "Nigeria", region: "Africa",  giniIndex: 35.1, incPctLo10: 26.7, incPctHi10: 2.9 },
{ countryName: "Ethiopia", region: "Africa",  giniIndex: 35, incPctLo10: 28.5, incPctHi10: 2.9 },
{ countryName: "Niger", region: "Africa",  giniIndex: 34.3, incPctLo10: 27, incPctHi10: 3.2 },
{ countryName: "Guinea", region: "Africa",  giniIndex: 33.7, incPctLo10: 26.4, incPctHi10: 3 },
{ countryName: "Mali", region: "Africa",  giniIndex: 33, incPctLo10: 25.7, incPctHi10: 3.3 },
{ countryName: "Comoros", region: "Arab States",  giniIndex: 45.3, incPctLo10: 33.7, incPctHi10: 1.6 },
{ countryName: "Djibouti", region: "Arab States",  giniIndex: 41.6, incPctLo10: 32.3, incPctHi10: 1.9 },
{ countryName: "Morocco", region: "Arab States",  giniIndex: 39.5, incPctLo10: 31.9, incPctHi10: 2.7 },
{ countryName: "Sudan", region: "Arab States",  giniIndex: 34.2, incPctLo10: 27.8, incPctHi10: 3.2 },
{ countryName: "Tunisia", region: "Arab States",  giniIndex: 32.8, incPctLo10: 25.6, incPctHi10: 3.2 },
{ countryName: "Mauritania", region: "Arab States",  giniIndex: 32.6, incPctLo10: 24.9, incPctHi10: 3 },
{ countryName: "Algeria", region: "Arab States",  giniIndex: 27.6, incPctLo10: 22.9, incPctHi10: 4 },
{ countryName: "Philippines", region: "Asia & Pacific",  giniIndex: 44.4, incPctLo10: 34.8, incPctHi10: 2.3 },
{ countryName: "Papua New Guinea", region: "Asia & Pacific",  giniIndex: 41.9, incPctLo10: 31, incPctHi10: 1.9 },
{ countryName: "Malaysia", region: "Asia & Pacific",  giniIndex: 41, incPctLo10: 31.3, incPctHi10: 2.3 },
{ countryName: "Turkmenistan", region: "Asia & Pacific",  giniIndex: 40.8, incPctLo10: 31.7, incPctHi10: 2.6 },
{ countryName: "Micronesia", region: "Asia & Pacific",  giniIndex: 40.1, incPctLo10: 29.7, incPctHi10: 1.9 },
{ countryName: "Sri Lanka", region: "Asia & Pacific",  giniIndex: 39.8, incPctLo10: 32.9, incPctHi10: 2.9 },
{ countryName: "Tuvalu", region: "Asia & Pacific",  giniIndex: 39.1, incPctLo10: 30.7, incPctHi10: 2.7 },
{ countryName: "Samoa", region: "Asia & Pacific",  giniIndex: 38.7, incPctLo10: 31.3, incPctHi10: 2.7 },
{ countryName: "China", region: "Asia & Pacific",  giniIndex: 38.5, incPctLo10: 29.4, incPctHi10: 2.7 },
{ countryName: "Indonesia", region: "Asia & Pacific",  giniIndex: 37.8, incPctLo10: 29.3, incPctHi10: 2.9 },
{ countryName: "Tonga", region: "Asia & Pacific",  giniIndex: 37.6, incPctLo10: 29.7, incPctHi10: 2.8 },
{ countryName: "Vanuatu", region: "Asia & Pacific",  giniIndex: 37.6, incPctLo10: 29.4, incPctHi10: 2.7 },
{ countryName: "Bhutan", region: "Asia & Pacific",  giniIndex: 37.4, incPctLo10: 27.9, incPctHi10: 2.7 },
{ countryName: "Solomon Is.", region: "Asia & Pacific",  giniIndex: 37.1, incPctLo10: 29.2, incPctHi10: 2.8 },
{ countryName: "Kiribati", region: "Asia & Pacific",  giniIndex: 37, incPctLo10: 29.2, incPctHi10: 2.6 },
{ countryName: "Fiji", region: "Asia & Pacific",  giniIndex: 36.7, incPctLo10: 29.7, incPctHi10: 3.1 },
{ countryName: "Laos", region: "Asia & Pacific",  giniIndex: 36.4, incPctLo10: 29.8, incPctHi10: 3.2 },
{ countryName: "Thailand", region: "Asia & Pacific",  giniIndex: 36.4, incPctLo10: 28.2, incPctHi10: 3 },
{ countryName: "Syria", region: "Asia & Pacific",  giniIndex: 35.8, incPctLo10: 28.7, incPctHi10: 3.2 },
{ countryName: "India", region: "Asia & Pacific",  giniIndex: 35.7, incPctLo10: 30.1, incPctHi10: 3.5 },
{ countryName: "Vietnam", region: "Asia & Pacific",  giniIndex: 35.7, incPctLo10: 27.5, incPctHi10: 2.5 },
{ countryName: "Uzbekistan", region: "Asia & Pacific",  giniIndex: 35.3, incPctLo10: 28.3, incPctHi10: 2.9 },
{ countryName: "Australia", region: "Asia & Pacific",  giniIndex: 34.4, incPctLo10: 27, incPctHi10: 2.8 },
{ countryName: "Tajikistan", region: "Asia & Pacific",  giniIndex: 34, incPctLo10: 26.4, incPctHi10: 3 },
{ countryName: "Pakistan", region: "Asia & Pacific",  giniIndex: 33.5, incPctLo10: 28.9, incPctHi10: 3.9 },
{ countryName: "Japan", region: "Asia & Pacific",  giniIndex: 32.9, incPctLo10: 26.4, incPctHi10: 2.9 },
{ countryName: "Nepal", region: "Asia & Pacific",  giniIndex: 32.8, incPctLo10: 26.4, incPctHi10: 3.5 },
{ countryName: "Mongolia", region: "Asia & Pacific",  giniIndex: 32.7, incPctLo10: 25.7, incPctHi10: 3.3 },
{ countryName: "Bangladesh", region: "Asia & Pacific",  giniIndex: 32.4, incPctLo10: 26.8, incPctHi10: 3.7 },
{ countryName: "North Korea", region: "Asia & Pacific",  giniIndex: 31.6, incPctLo10: 23.8, incPctHi10: 2.6 },
{ countryName: "Maldives", region: "Asia & Pacific",  giniIndex: 31.3, incPctLo10: 25.2, incPctHi10: 3.4 },
{ countryName: "Myanmar", region: "Asia & Pacific",  giniIndex: 30.7, incPctLo10: 25.5, incPctHi10: 3.8 },
{ countryName: "Timor-Leste", region: "Asia & Pacific",  giniIndex: 28.7, incPctLo10: 24, incPctHi10: 4 },
{ countryName: "Kyrgyzstan", region: "Asia & Pacific",  giniIndex: 27.7, incPctLo10: 23.6, incPctHi10: 4.3 },
{ countryName: "Kazakhstan", region: "Asia & Pacific",  giniIndex: 27.5, incPctLo10: 23, incPctHi10: 4.3 },
{ countryName: "Azerbaijan", region: "Asia & Pacific",  giniIndex: 26.6, incPctLo10: 24.2, incPctHi10: 4.8 },
{ countryName: "Turkey", region: "Europe",  giniIndex: 41.9, incPctLo10: 32.6, incPctHi10: 2.2 },
{ countryName: "Bulgaria", region: "Europe",  giniIndex: 40.4, incPctLo10: 31.9, incPctHi10: 1.9 },
{ countryName: "Israel", region: "Europe",  giniIndex: 39, incPctLo10: 27.8, incPctHi10: 1.9 },
{ countryName: "Montenegro", region: "Europe",  giniIndex: 39, incPctLo10: 27.7, incPctHi10: 1.8 },
{ countryName: "Russia", region: "Europe",  giniIndex: 37.5, incPctLo10: 29.9, incPctHi10: 2.9 },
{ countryName: "Lithuania", region: "Europe",  giniIndex: 37.3, incPctLo10: 28.4, incPctHi10: 2.1 },
{ countryName: "Georgia", region: "Europe",  giniIndex: 36.4, incPctLo10: 27.5, incPctHi10: 2.4 },
{ countryName: "Serbia", region: "Europe",  giniIndex: 36.2, incPctLo10: 25.6, incPctHi10: 1.4 },
{ countryName: "Romania", region: "Europe",  giniIndex: 36, incPctLo10: 24.9, incPctHi10: 1.6 },
{ countryName: "Italy", region: "Europe",  giniIndex: 35.9, incPctLo10: 26.7, incPctHi10: 1.9 },
{ countryName: "Latvia", region: "Europe",  giniIndex: 35.6, incPctLo10: 26.9, incPctHi10: 2.3 },
{ countryName: "Luxembourg", region: "Europe",  giniIndex: 34.9, incPctLo10: 25.8, incPctHi10: 2.4 },
{ countryName: "United Kingdom", region: "Europe",  giniIndex: 34.8, incPctLo10: 26.8, incPctHi10: 2.8 },
{ countryName: "Spain", region: "Europe",  giniIndex: 34.7, incPctLo10: 25.4, incPctHi10: 2.1 },
{ countryName: "Armenia", region: "Europe",  giniIndex: 34.4, incPctLo10: 29.2, incPctHi10: 3.3 },
{ countryName: "Greece", region: "Europe",  giniIndex: 34.4, incPctLo10: 25.9, incPctHi10: 2.4 },
{ countryName: "Macedonia", region: "Europe",  giniIndex: 34.2, incPctLo10: 23.8, incPctHi10: 1.7 },
{ countryName: "Portugal", region: "Europe",  giniIndex: 33.8, incPctLo10: 26.7, incPctHi10: 2.7 },
{ countryName: "West Bank and Gaza", region: "Europe",  giniIndex: 33.7, incPctLo10: 25.2, incPctHi10: 2.9 },
{ countryName: "Albania", region: "Europe",  giniIndex: 33.2, incPctLo10: 24.8, incPctHi10: 3.1 },
{ countryName: "Bosnia and Herz.", region: "Europe",  giniIndex: 33, incPctLo10: 25.1, incPctHi10: 2.9 },
{ countryName: "Ireland", region: "Europe",  giniIndex: 32.8, incPctLo10: 25.9, incPctHi10: 3.1 },
{ countryName: "Switzerland", region: "Europe",  giniIndex: 32.7, incPctLo10: 25.5, incPctHi10: 3.1 },
{ countryName: "Germany", region: "Europe",  giniIndex: 31.9, incPctLo10: 24.6, incPctHi10: 2.9 },
{ countryName: "France", region: "Europe",  giniIndex: 31.6, incPctLo10: 25.8, incPctHi10: 3.2 },
{ countryName: "Cyprus", region: "Europe",  giniIndex: 31.4, incPctLo10: 25.5, incPctHi10: 3.4 },
{ countryName: "Hungary", region: "Europe",  giniIndex: 30.6, incPctLo10: 23.9, incPctHi10: 3 },
{ countryName: "Croatia", region: "Europe",  giniIndex: 30.4, incPctLo10: 22.8, incPctHi10: 2.7 },
{ countryName: "Estonia", region: "Europe",  giniIndex: 30.4, incPctLo10: 22.5, incPctHi10: 3 },
{ countryName: "Austria", region: "Europe",  giniIndex: 29.7, incPctLo10: 23, incPctHi10: 3 },
{ countryName: "Poland", region: "Europe",  giniIndex: 29.7, incPctLo10: 23.5, incPctHi10: 3.2 },
{ countryName: "Malta", region: "Europe",  giniIndex: 29.2, incPctLo10: 23.3, incPctHi10: 3.4 },
{ countryName: "Kosovo", region: "Europe",  giniIndex: 29, incPctLo10: 24.6, incPctHi10: 3.8 },
{ countryName: "Sweden", region: "Europe",  giniIndex: 28.8, incPctLo10: 22.3, incPctHi10: 3 },
{ countryName: "Denmark", region: "Europe",  giniIndex: 28.7, incPctLo10: 24, incPctHi10: 3.7 },
{ countryName: "Netherlands", region: "Europe",  giniIndex: 28.5, incPctLo10: 23.3, incPctHi10: 3.5 },
{ countryName: "Belgium", region: "Europe",  giniIndex: 27.4, incPctLo10: 21.9, incPctHi10: 3.3 },
{ countryName: "Finland", region: "Europe",  giniIndex: 27.4, incPctLo10: 22.6, incPctHi10: 3.8 },
{ countryName: "Norway", region: "Europe",  giniIndex: 27, incPctLo10: 21.6, incPctHi10: 3.3 },
{ countryName: "Iceland", region: "Europe",  giniIndex: 26.8, incPctLo10: 22.5, incPctHi10: 3.9 },
{ countryName: "Ukraine", region: "Europe",  giniIndex: 26.1, incPctLo10: 22, incPctHi10: 4.2 },
{ countryName: "Moldova", region: "Europe",  giniIndex: 25.7, incPctLo10: 22, incPctHi10: 4.4 },
{ countryName: "Belarus", region: "Europe",  giniIndex: 25.2, incPctLo10: 21.4, incPctHi10: 4.3 },
{ countryName: "Slovakia", region: "Europe",  giniIndex: 25.2, incPctLo10: 19.9, incPctHi10: 2.9 },
{ countryName: "Czechia", region: "Europe",  giniIndex: 24.9, incPctLo10: 21.5, incPctHi10: 4.2 },
{ countryName: "Slovenia", region: "Europe",  giniIndex: 24.2, incPctLo10: 20.4, incPctHi10: 4.1 },
{ countryName: "Iran", region: "Middle east",  giniIndex: 40.8, incPctLo10: 31.3, incPctHi10: 2.3 },
{ countryName: "Yemen", region: "Middle east",  giniIndex: 36.7, incPctLo10: 29.4, incPctHi10: 3 },
{ countryName: "Jordan", region: "Middle east",  giniIndex: 33.7, incPctLo10: 27.5, incPctHi10: 3.5 },
{ countryName: "United Arab Emirates", region: "Middle east",  giniIndex: 32.5, incPctLo10: 21.4, incPctHi10: 2.3 },
{ countryName: "Lebanon", region: "Middle east",  giniIndex: 31.8, incPctLo10: 24.8, incPctHi10: 3.1 },
{ countryName: "Egypt", region: "Middle east",  giniIndex: 31.5, incPctLo10: 26.9, incPctHi10: 3.8 },
{ countryName: "Iraq", region: "Middle east",  giniIndex: 29.5, incPctLo10: 23.7, incPctHi10: 3.7 },
{ countryName: "United States of America", region: "North America",  giniIndex: 41.1, incPctLo10: 30.4, incPctHi10: 1.8 },
{ countryName: "Canada", region: "North America",  giniIndex: 33.3, incPctLo10: 25.3, incPctHi10: 2.7 },
{ countryName: "Suriname", region: "South/Latin America",  giniIndex: 57.6, incPctLo10: 42.7, incPctHi10: 0 },
{ countryName: "Brazil", region: "South/Latin America",  giniIndex: 53.9, incPctLo10: 42.5, incPctHi10: 1 },
{ countryName: "Belize", region: "South/Latin America",  giniIndex: 53.3, incPctLo10: 42.4, incPctHi10: 0.9 },
{ countryName: "Honduras", region: "South/Latin America",  giniIndex: 52.1, incPctLo10: 39.1, incPctHi10: 0.9 },
{ countryName: "Saint Lucia", region: "South/Latin America",  giniIndex: 51.2, incPctLo10: 38.6, incPctHi10: 0.9 },
{ countryName: "Colombia", region: "South/Latin America",  giniIndex: 50.4, incPctLo10: 39.7, incPctHi10: 1.4 },
{ countryName: "Panama", region: "South/Latin America",  giniIndex: 49.2, incPctLo10: 37.1, incPctHi10: 1.2 },
{ countryName: "Guatemala", region: "South/Latin America",  giniIndex: 48.3, incPctLo10: 38, incPctHi10: 1.7 },
{ countryName: "Costa Rica", region: "South/Latin America",  giniIndex: 48, incPctLo10: 36.3, incPctHi10: 1.5 },
{ countryName: "Venezuela", region: "South/Latin America",  giniIndex: 46.9, incPctLo10: 34.1, incPctHi10: 0.5 },
{ countryName: "Nicaragua", region: "South/Latin America",  giniIndex: 46.2, incPctLo10: 37.2, incPctHi10: 2 },
{ countryName: "Paraguay", region: "South/Latin America",  giniIndex: 46.2, incPctLo10: 35.9, incPctHi10: 1.7 },
{ countryName: "Jamaica", region: "South/Latin America",  giniIndex: 45.5, incPctLo10: 35.8, incPctHi10: 2.1 },
{ countryName: "Ecuador", region: "South/Latin America",  giniIndex: 45.4, incPctLo10: 34.4, incPctHi10: 1.6 },
{ countryName: "Mexico", region: "South/Latin America",  giniIndex: 45.4, incPctLo10: 36.4, incPctHi10: 2 },
{ countryName: "Guyana", region: "South/Latin America",  giniIndex: 44.6, incPctLo10: 34.1, incPctHi10: 1.5 },
{ countryName: "Chile", region: "South/Latin America",  giniIndex: 44.4, incPctLo10: 36.3, incPctHi10: 2.3 },
{ countryName: "Dominican Rep.", region: "South/Latin America",  giniIndex: 43.7, incPctLo10: 35.2, incPctHi10: 2.3 },
{ countryName: "Peru", region: "South/Latin America",  giniIndex: 42.8, incPctLo10: 32.1, incPctHi10: 1.8 },
{ countryName: "Bolivia", region: "South/Latin America",  giniIndex: 42.2, incPctLo10: 30.4, incPctHi10: 1.5 },
{ countryName: "Argentina", region: "South/Latin America",  giniIndex: 41.4, incPctLo10: 29.9, incPctHi10: 1.8 },
{ countryName: "Haiti", region: "South/Latin America",  giniIndex: 41.1, incPctLo10: 31.2, incPctHi10: 2.1 },
{ countryName: "Uruguay", region: "South/Latin America",  giniIndex: 39.7, incPctLo10: 29.7, incPctHi10: 2.3 },
{ countryName: "El Salvador", region: "South/Latin America",  giniIndex: 38.6, incPctLo10: 29.4, incPctHi10: 2.4 },
 ];	 

// set initial group value
var region = "South/Latin America";

function dataBarChosen(region) {
	var ds = [];
	if (region == "All") {
	 	for (i in dataBarChart) {
		 	ds.push(dataBarChart[i]);
		}

	}
	else {
	 	for (i in dataBarChart) {
			 if(dataBarChart[i].region==region){
			 	ds.push(dataBarChart[i]);
		 	} 
		}

	}	
	return ds;
}



function dsBarChart() {

	console.log('In dsBarChart');
	//Read CSV containing wealth inequality information
	//var econcsv = d3.csv("MatchTopo_Distribution_of_Income.csv", function(data) {
	//   return {	
	//	    countryName: data.DISPCountry,
	//	    region:     data.DISPRegion,
	//	    giniIndex: +data.DIGiniIndex,
	//	    incPctHi10: +data.DIPctIncShareHighest10,
	//	    incPctLo10: +data.DIPctIncShareLowest10
	//    }	    
        //});
	//console.log("econcsv: " + econcsv);
	//Promise.all([econcsv]).then(values => {
	//	console.log("Promise returned values: " + values);
	//	console.log("Promise returned values.countryName: " + values.countryName);
	//})
	
	var firstDataBarChart = dataBarChosen(region);    
	console.log("firstDataBarChart dataBarChosen for region: " + region);
	console.log("firstDataBarChart[0]: ", firstDataBarChart[0]);
	console.log("firstDataBarChart.length: " + firstDataBarChart.length);
	console.log("firstDataBarChart[length]: ", firstDataBarChart[firstDataBarChart.length-1]);
	
	
	var margin = {top: 30, right: 5, bottom: 70, left: 50},
	    width = 500 - margin.left - margin.right,
	    height = 250 - margin.top - margin.bottom,
	    colorBar = d3.interpolateBlues((63 - 20) / 44),
	    barPadding = .1
	;
	
			
	var xScale = d3.scaleLinear()
			.domain([0, firstDataBarChart.length])
			.range([0, width])
			;
						
	var yScale = d3.scaleLinear()
		   .domain([d3.min(firstDataBarChart, function(d) { return d.giniIndex; }), d3.max(firstDataBarChart, function(d) { return d.giniIndex; })])
		   .range([height, 0])
		   ;
	//	   .domain([23, d3.max(firstDataBarChart, function(d) { return d.giniIndex; })])
	
	/*-----------------------------------------------------beg new add axis stuff */
	// For X axis - Country
	const xAxis = d3.scaleBand()
	    .domain(firstDataBarChart.map(d => d.countryName))
	    .range([ 0, width]);

	// ForY axis - Gini Index
	const yAxis = d3.scaleLinear()
	    .domain(firstDataBarChart.map(d => d.giniIndex))
	    .range([ 0, height ]);
	/*-----------------------------------------------------end new add axis stuff */
	
	var svg = d3.select("#barChart")
		    .append("svg")
		    .attr("width", width + margin.left + margin.right)
		    .attr("height", height + margin.top + margin.bottom)
		    .attr("id","barChartPlot")
		    ;
	
	var plot = svg
		    .append("g")
		    .attr("transform", "translate(" + margin.left +  "," + margin.top + ")")
		    ;
	/*-----------------------------------------------------beg new add axis stuff */
	// Add X axis Country
	  svg.append("g")
	    .attr("transform", `translate(${margin.left}, ${height + margin.top + 14} )`)
	    .call(d3.axisBottom(xAxis))
	    .selectAll("text")
	      .attr("transform", "translate(-10,0)rotate(-35)")
	      .style("text-anchor", "end");

	  // Add Y axis - Gini Index
	  svg.append("g")
	    .attr("transform", `translate(${margin.left}, ${margin.top + 14})`)
	    .call(d3.axisLeft(yAxis))
	/*-----------------------------------------------------end new add axis stuff */
	/*-------------------*/
	/* ...adding bars... */
	/*-------------------*/
	plot.selectAll("rect")
		   .data(firstDataBarChart)
		   .enter()
		   .append("rect")
			.attr("x", function(d, i) {
			    return xScale(i);
			})
		   .attr("width", width / firstDataBarChart.length - barPadding)   
			.attr("y", function(d) {
			    return yScale(d.giniIndex);
			})  
			.attr("height", function(d) {
			    return (height - yScale(d.giniIndex) + 14);
			})
			.attr("fill", function(d) { 
		             //console.log("d", d)
		             //console.log("giniIndex", d.giniIndex)
		             var col =  d3.interpolateBlues((d.giniIndex - 20) / 44); 
		             //console.log("col", col)
		             if (col) {
		                //console.log("found col", col, "for d", d)
		                return col
		             } else {
		                return 'white'
		             }
	                })
			;
	
	/*----------------------------------*/
	/* ...adding labels on the bars ... */
	/*----------------------------------*/		
	plot.selectAll("text")
	    .data(firstDataBarChart)
	    .enter()
	    .append("text")
	    .text(function(d) {
		return d.giniIndex;
	})
	.attr("text-anchor", "middle")
	.attr("x", function(d, i) {
	    return (i * (width / firstDataBarChart.length)) + ((width / firstDataBarChart.length - barPadding) / 2);
	})
	.attr("y", function(d) {
	    return yScale(d.giniIndex) + 14;
	})
	.attr("class", "yOnBar")
	;
	
	//var xLabels = svg
	//	    .append("g")
	//	    .attr("transform", "translate(" + margin.left + "," + (margin.top + height)  + ")")
	//	    ;
	
	//xLabels.selectAll("text.xAxis")
	//	  .data(firstDataBarChart)
	//	  .enter()
	//	  .append("text")
	//	  .text(function(d) { return d.countryName;})
	//	  .attr("text-anchor", "middle")
			// Set x position to the left edge of each bar plus half the bar width
	//					   .attr("x", function(d, i) {
	//					   return (i * (width / firstDataBarChart.length)) + ((width / firstDataBarChart.length - barPadding) / 2);
	//					   })
	//	  .attr("y", 15)
	//	  .attr("class", "xAxis")
		  //.attr("style", "font-size: 12; font-family: Helvetica, sans-serif")
	//	  ;			
	 
	// Title	
	svg.append("text")
		.attr("x", (width + margin.left + margin.right)/2)
		.attr("y", 15)
		.attr("class","title")				
		.attr("text-anchor", "middle")
		.text("Distribution of Income")
		;
}


 /* ** UPDATE CHART ** */
 
/* updates bar chart on request */

function updateBarChart(region, colorChosen) {
	console.log('In updateBarChart');
	var currDataBarChart = dataBarChosen(region);
	console.log("currtDataBarChart dataBarChosen for region: " + region);
	console.log("currDataBarChart[0]: ", currDataBarChart[0]);
	console.log("currDataBarChart.length: " + currDataBarChart.length);
	console.log("currDataBarChart[length]: ", currDataBarChart[currDataBarChart.length-1]);
		
	var margin = {top: 30, right: 5, bottom: 50, left: 50},
	    width = 500 - margin.left - margin.right,
	    height = 250 - margin.top - margin.bottom,
	    colorBar = d3.interpolateBlues((63 - 20) / 44),
	    barPadding = .1
	;
		
	var xScale = d3.scaleLinear()
		.domain([0, currDataBarChart.length])
		.range([0, width])
		;
		
			
	var yScale = d3.scaleLinear()
	      .domain([0, d3.max(currDataBarChart, function(d) { return d.giniIndex; })])
	      .range([height,0])
	      ;
	      
	var svg = d3.select("#barChart svg");
	      
	var plot = d3.select("#barChartPlot")
		.datum(currDataBarChart)
		;
	
  	plot.selectAll("rect")
	      	.data(currentDatasetBarChart)
	      	.transition()
		.duration(1000)
		.attr("x", function(d, i) {
		return xScale(i);
		})
		.attr("width", width / currDataBarChart.length - barPadding)   
		.attr("y", function(d) {
		return yScale(d.giniIndex);
		})  
		.attr("height", function(d) {
		return height-yScale(d.giniIndex);
		})
		.attr("fill", function(d) { 
		     //console.log("d", d)
		     //console.log("giniIndex", d.giniIndex)
		     var col =  d3.interpolateBlues((d.giniIndex - 20) / 44); 
		     //console.log("col", col)
		     if (col) {
			//console.log("found col", col, "for d", d)
			return col
		     } else {
			return 'white'
		     }
		})
		;
		
	plot.selectAll("text.yOnBar") // target the text element(s) which has a yOnBar class defined
		.data(currDataBarChart)
		.transition()
		.duration(1000)
		.attr("text-anchor", "middle")
		.attr("x", function(d, i) {
		return (i * (width / currDataBarChart.length)) + ((width / currDataBarChart.length - barPadding) / 2);
		})
		.attr("y", function(d) {
		return yScale(d.giniIndex) + 14;
		})
		.text(function(d) {
		return d.giniIndex;
		})
		.attr("class", "yOnBar")					 
		;
		
		svg.selectAll("text.title") // target the text element(s) which has a title class defined
			.attr("x", (width + margin.left + margin.right)/2)
			.attr("y", 15)
			.attr("class","title")				
			.attr("text-anchor", "middle")
			.text(region + " Gini Index (reference years 2010-2019")
		;
}
	    
/*============================================================================================================*/
/*============================================================================================================*/
/* End of Bar Chart  Gini Index                                                                                          */
/*============================================================================================================*/
/*============================================================================================================*/


/*
############# LINE CHART ##################
-------------------------------------------
*/

var datasetLineChart = [
{ group: "All", category: 2008, measure: 289309 }, 
{ group: "All", category: 2009, measure: 234998 }, 
{ group: "All", category: 2010, measure: 310900 }, 
{ group: "All", category: 2011, measure: 223900 }, 
{ group: "All", category: 2012, measure: 234500 }, 
{ group: "Sam", category: 2008, measure: 81006.52 }, 
{ group: "Sam", category: 2009, measure: 70499.4 }, 
{ group: "Sam", category: 2010, measure: 96379 }, 
{ group: "Sam", category: 2011, measure: 64931 }, 
{ group: "Sam", category: 2012, measure: 70350 }, 
{ group: "Peter", category: 2008, measure: 63647.98 }, 
{ group: "Peter", category: 2009, measure: 61099.48 }, 
{ group: "Peter", category: 2010, measure: 87052 }, 
{ group: "Peter", category: 2011, measure: 58214 }, 
{ group: "Peter", category: 2012, measure: 58625 }, 
{ group: "Rick", category: 2008, measure: 23144.72 }, 
{ group: "Rick", category: 2009, measure: 14099.88 }, 
{ group: "Rick", category: 2010, measure: 15545 }, 
{ group: "Rick", category: 2011, measure: 11195 }, 
{ group: "Rick", category: 2012, measure: 11725 }, 
{ group: "John", category: 2008, measure: 34717.08 }, 
{ group: "John", category: 2009, measure: 30549.74 }, 
{ group: "John", category: 2010, measure: 34199 }, 
{ group: "John", category: 2011, measure: 33585 }, 
{ group: "John", category: 2012, measure: 35175 }, 
{ group: "Lenny", category: 2008, measure: 69434.16 }, 
{ group: "Lenny", category: 2009, measure: 46999.6 }, 
{ group: "Lenny", category: 2010, measure: 62180 }, 
{ group: "Lenny", category: 2011, measure: 40302 }, 
{ group: "Lenny", category: 2012, measure: 42210 }, 
{ group: "Paul", category: 2008, measure: 7232.725 }, 
{ group: "Paul", category: 2009, measure: 4699.96 }, 
{ group: "Paul", category: 2010, measure: 6218 }, 
{ group: "Paul", category: 2011, measure: 8956 }, 
{ group: "Paul", category: 2012, measure: 9380 }, 
{ group: "Steve", category: 2008, measure: 10125.815 }, 
{ group: "Steve", category: 2009, measure: 7049.94 }, 
{ group: "Steve", category: 2010, measure: 9327 }, 
{ group: "Steve", category: 2011, measure: 6717 }, 
{ group: "Steve", category: 2012, measure: 7035 }
]
;

// set initial category value
var group = "All";

function datasetLineChartChosen(group) {
	var ds = [];
	for (x in datasetLineChart) {
		 if(datasetLineChart[x].group==group){
		 	ds.push(datasetLineChart[x]);
		 } 
		}
	return ds;
}

function dsLineChartBasics() {

	var margin = {top: 20, right: 10, bottom: 0, left: 50},
	    width = 500 - margin.left - margin.right,
	    height = 150 - margin.top - margin.bottom
	    ;
		
		return {
			margin : margin, 
			width : width, 
			height : height
		}			
		;
}


function dsLineChart() {

	var firstDatasetLineChart = datasetLineChartChosen(group);    
	
	var basics = dsLineChartBasics();
	
	var margin = basics.margin,
		width = basics.width,
	        height = basics.height
		;

	var xScale = d3.scaleLinear()
	    .domain([0, firstDatasetLineChart.length-1])
	    .range([0, width])
	    ;

	var yScale = d3.scaleLinear()
	    .domain([0, d3.max(firstDatasetLineChart, function(d) { return d.measure; })])
	    .range([height, 0])
	    ;
	
	var line = d3.line()
	    //.x(function(d) { return xScale(d.category); })
	    .x(function(d, i) { return xScale(i); })
	    .y(function(d) { return yScale(d.measure); })
	    ;
	
	var svg = d3.select("#lineChart").append("svg")
	    .datum(firstDatasetLineChart)
	    .attr("width", width + margin.left + margin.right)
	    .attr("height", height + margin.top + margin.bottom)
	    // create group and move it so that margins are respected (space for axis and title)
	    
	var plot = svg
	    .append("g")
	    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
	    .attr("id", "lineChartPlot")
	    ;

		/* descriptive titles as part of plot -- start */
	var dsLength=firstDatasetLineChart.length;

	plot.append("text")
		.text(firstDatasetLineChart[dsLength-1].measure)
		.attr("id","lineChartTitle2")
		.attr("x",width/2)
		.attr("y",height/2)	
		;
	/* descriptive titles -- end */
	    
	plot.append("path")
	    .attr("class", "line")
	    .attr("d", line)	
	    // add color
		.attr("stroke", "lightgrey")
	    ;
	  
	plot.selectAll(".dot")
	    .data(firstDatasetLineChart)
	  	 .enter().append("circle")
	    .attr("class", "dot")
	    //.attr("stroke", function (d) { return d.measure==datasetMeasureMin ? "red" : (d.measure==datasetMeasureMax ? "green" : "steelblue") } )
	    .attr("fill", function (d) { return d.measure==d3.min(firstDatasetLineChart, function(d) { return d.measure; }) ? "red" : (d.measure==d3.max(firstDatasetLineChart, function(d) { return d.measure; }) ? "green" : "white") } )
	    //.attr("stroke-width", function (d) { return d.measure==datasetMeasureMin || d.measure==datasetMeasureMax ? "3px" : "1.5px"} )
	    .attr("cx", line.x())
	    .attr("cy", line.y())
	    .attr("r", 3.5)
	    .attr("stroke", "lightgrey")
	    .append("title")
	    .text(function(d) { return d.category + ": " + d.measure; })
	    ;

	svg.append("text")
		.text("Performance 2012")
		.attr("id","lineChartTitle1")	
		.attr("x",margin.left + ((width + margin.right)/2))
		.attr("y", 10)
		;

}



 /* ** UPDATE CHART ** */
 
/* updates bar chart on request */
function updateLineChart(group, colorChosen) {

	var currentDatasetLineChart = datasetLineChartChosen(group);   

	var basics = dsLineChartBasics();
	
	var margin = basics.margin,
		width = basics.width,
	   height = basics.height
		;

	var xScale = d3.scale.linear()
	    .domain([0, currentDatasetLineChart.length-1])
	    .range([0, width])
	    ;

	var yScale = d3.scale.linear()
	    .domain([0, d3.max(currentDatasetLineChart, function(d) { return d.measure; })])
	    .range([height, 0])
	    ;
	
	var line = d3.svg.line()
    .x(function(d, i) { return xScale(i); })
    .y(function(d) { return yScale(d.measure); })
    ;

   var plot = d3.select("#lineChartPlot")
   	.datum(currentDatasetLineChart)
	   ;
	   
	/* descriptive titles as part of plot -- start */
	var dsLength=currentDatasetLineChart.length;
	
	plot.select("text")
		.text(currentDatasetLineChart[dsLength-1].measure)
		;
	/* descriptive titles -- end */
	   
	plot
	.select("path")
		.transition()
		.duration(750)			    
	   .attr("class", "line")
	   .attr("d", line)	
	   // add color
		.attr("stroke", colorChosen)
	   ;
	   
	var path = plot
		.selectAll(".dot")
	   .data(currentDatasetLineChart)
	   .transition()
		.duration(750)
	   .attr("class", "dot")
	   .attr("fill", function (d) { return d.measure==d3.min(currentDatasetLineChart, function(d) { return d.measure; }) ? "red" : (d.measure==d3.max(currentDatasetLineChart, function(d) { return d.measure; }) ? "green" : "white") } )
	   .attr("cx", line.x())
	   .attr("cy", line.y())
	   .attr("r", 3.5)
	   // add color
		.attr("stroke", colorChosen)
	   ;
	   
	   path
	   .selectAll("title")
	   .text(function(d) { return d.category + ": " + formatAsInteger(d.measure); })	 
	   ;  

}
    
    dsMapChart();
    dsBarChart();
    //dsLineChart();	  
	  
    //d3.selectAll(".hideme").attr('visibility',visible);
	   	    

    </script>
  </body>
</html>
